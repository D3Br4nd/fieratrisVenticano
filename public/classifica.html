<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classifica - FieraTris Venticano</title>
    <link rel="stylesheet" href="css/style.css">
     <style>
        /* Stili specifici per la classifica - da spostare in style.css */
        body { margin: 0; font-family: sans-serif; padding: 20px; background-color: #f0f0f0;}
        #leaderboard { margin: 20px auto; max-width: 600px; background-color: #fff; padding: 15px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #e9e9e9; }
        td:nth-child(1) { width: 50px; text-align: center;} /* Colonna Pos. */
        td:nth-child(3) { text-align: right; font-weight: bold;} /* Colonna Punteggio */
        .loading { text-align: center; padding: 20px; }
        .error { text-align: center; padding: 20px; color: red; }
        .back-link { display: block; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="leaderboard">
        <h1>Classifica FieraTris Venticano</h1>
        <div id="loading-indicator" class="loading">Caricamento classifica...</div>
        <div id="error-message" class="error" style="display: none;">Impossibile caricare la classifica.</div>
        <table>
            <thead>
                <tr>
                    <th>Pos.</th>
                    <th>Nome</th>
                    <th>Punteggio</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                <!-- Le righe verranno popolate via JS -->
            </tbody>
        </table>
        <!-- Link per tornare al gioco -->
        <a href="index.html" class="back-link">Torna al gioco</a>
    </div>

    <script src="js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const tbody = document.getElementById('leaderboard-body');
            const loadingIndicator = document.getElementById('loading-indicator');
            const errorMessage = document.getElementById('error-message');

            try {
                // Ottieni i punteggi
                console.log('Richiesta punteggi al server...');
                const scores = await api.getScores();
                console.log('Punteggi ricevuti:', scores);

                loadingIndicator.style.display = 'none'; // Nascondi caricamento

                if (scores && scores.length > 0) {
                    // Ordina i punteggi dal più alto al più basso prima di mostrarli
                    const sortedScores = [...scores].sort((a, b) => b.score - a.score);
                    
                    // Svuota la tabella per sicurezza
                    tbody.innerHTML = '';
                    
                    // Aggiungi le righe ordinate
                    sortedScores.forEach((entry, index) => {
                        const row = tbody.insertRow();
                        const posCell = row.insertCell();
                        const nameCell = row.insertCell();
                        const scoreCell = row.insertCell();

                        posCell.textContent = index + 1;
                        nameCell.textContent = entry.name || 'Anonimo';
                        scoreCell.textContent = entry.score || 0;
                        
                        // Evidenzia i migliori punteggi
                        if (index === 0) {
                            row.style.backgroundColor = '#FFD700'; // Oro per il primo posto
                            row.style.fontWeight = 'bold';
                        } else if (index === 1) {
                            row.style.backgroundColor = '#C0C0C0'; // Argento per il secondo posto
                        } else if (index === 2) {
                            row.style.backgroundColor = '#CD7F32'; // Bronzo per il terzo posto
                        }
                    });
                } else {
                    // Mostra messaggio se non ci sono punteggi
                    const row = tbody.insertRow();
                    const cell = row.insertCell();
                    cell.colSpan = 3; // Occupa tutte le colonne
                    cell.textContent = 'Nessun punteggio registrato ancora!';
                    cell.style.textAlign = 'center';
                }

            } catch (error) {
                console.error("Failed to load leaderboard:", error);
                loadingIndicator.style.display = 'none'; // Nascondi caricamento
                errorMessage.style.display = 'block'; // Mostra errore
            }
        });
    </script>
</body>
</html>