<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Classifica - FieraTris Venticano</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/leaderboard.css">
</head>
<body>
    <div class="leaderboard-container">
        <img src="assets/img/logo-fiera.png" alt="Logo Fiera Venticano" class="logo">
        <h1>Classifica FieraTris</h1>
        
        <div id="loading-indicator">Caricamento classifica in corso...</div>
        
        <div id="error-message">
            Si è verificato un errore nel caricamento della classifica. Riprova più tardi.
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>Pos.</th>
                    <th>Nome</th>
                    <th>Punteggio</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                <!-- Dati classifica -->
            </tbody>
        </table>
        
        <a href="index.html" class="back-button">Torna al Gioco</a>
    </div>

    <script src="js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const tbody = document.getElementById('leaderboard-body');
            const loadingIndicator = document.getElementById('loading-indicator');
            const errorMessage = document.getElementById('error-message');

            try {
                // Ottieni i punteggi dal server
                const scores = await api.getScores();
                console.log('Punteggi ricevuti:', scores);

                loadingIndicator.style.display = 'none'; // Nascondi caricamento

                if (scores && scores.length > 0) {
                    // Ordina i punteggi dal più alto al più basso prima di mostrarli
                    const sortedScores = [...scores].sort((a, b) => b.score - a.score);
                    
                    // Svuota la tabella per sicurezza
                    tbody.innerHTML = '';
                    
                    // Aggiungi le righe ordinate
                    sortedScores.forEach((entry, index) => {
                        const row = tbody.insertRow();
                        const posCell = row.insertCell();
                        const nameCell = row.insertCell();
                        const scoreCell = row.insertCell();

                        // Aggiungi classi per le posizioni top
                        if (index === 0) {
                            row.classList.add('gold');
                        } else if (index === 1) {
                            row.classList.add('silver');
                        } else if (index === 2) {
                            row.classList.add('bronze');
                        }

                        posCell.textContent = index + 1;
                        nameCell.textContent = entry.name || 'Anonimo';
                        scoreCell.textContent = entry.score || 0;
                    });
                } else {
                    // Mostra messaggio se non ci sono punteggi
                    const row = tbody.insertRow();
                    const cell = row.insertCell();
                    cell.colSpan = 3; // Occupa tutte le colonne
                    cell.textContent = 'Nessun punteggio registrato ancora!';
                    cell.style.textAlign = 'center';
                    cell.style.padding = '20px';
                }

            } catch (error) {
                console.error("Failed to load leaderboard:", error);
                loadingIndicator.style.display = 'none'; // Nascondi caricamento
                errorMessage.style.display = 'block'; // Mostra errore
            }
        });
    </script>
</body>
</html>